allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherBP_up <- runTest(BP_up,algorithm="parentchild",statistic="fisher")
BPgenTable_up <- GenTable(BP_up,Fisher=FisherBP_up,ranksOf="Fisher",
topNodes=length(score(FisherBP_up)))
BPgenTable_up$Fisher<-as.numeric(BPgenTable_up$Fisher)
BPgenTable_up$fdr <- p.adjust(BPgenTable_up$Fisher,method="fdr")
#GO term Enrichment for Molecular Function
MF_up <- new("topGOdata",description="Molecular Function",ontology="MF",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherMF_up <- runTest(MF_up,algorithm="parentchild",statistic="fisher")
MFgenTable_up <- GenTable(MF_up,Fisher=FisherMF_up,ranksOf="Fisher",
topNodes=length(score(FisherMF_up)))
MFgenTable_up$Fisher<-as.numeric(MFgenTable_up$Fisher)
MFgenTable_up$fdr <- p.adjust(MFgenTable_up$Fisher,method="fdr")
#GO term Enrichment for Cellular Component
CC_up <- new("topGOdata",description="Cellular Component",ontology="CC",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherCC_up <- runTest(CC_up,algorithm="parentchild",statistic="fisher")
CCgenTable_up <- GenTable(CC_up,Fisher=FisherCC_up,ranksOf="Fisher",
topNodes=length(score(FisherCC_up)))
CCgenTable_up$Fisher<-as.numeric(CCgenTable_up$Fisher)
CCgenTable_up$fdr <- p.adjust(CCgenTable_up$Fisher,method="fdr")
head(BPgenTable_up,20)
head(MFgenTable_up,20)
#Function for making dot plots of Enriched GO terms
GOdotplot <- function(x,fdr=0.05){
require(ggplot2)
x=head(x[x$fdr < fdr,],10)
ggplot(x[x$fdr < fdr,],aes(x=Significant/Annotated,
y=reorder(Term,Significant/Annotated))) +
geom_point(aes(color=fdr,size=Significant)) +
theme_bw() +
scale_color_continuous(low="red",high="blue") +
xlab("Gene Ratio (DEGs/Annotated Genes)") +
ylab("") +
labs(size="Gene Count",color="FDR") +
ggtitle("Top 10 Enriched GO Terms")
}
GOdotplot(BPgenTable_up)
CCgenTable_up$fdr <- p.adjust(CCgenTable_up$Fisher,method="fdr")
GOdotplot(MFgenTable_up)
#GO term Enrichment for Biological Process
BP_up <- new("topGOdata",description="Biological Process",ontology="BP",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherBP_up <- runTest(BP_up,algorithm="parentchild",statistic="fisher")
BPgenTable_up$fdr <- p.adjust(BPgenTable_up$Fisher,method="fdr")
head(BPgenTable_up)
BPgenTable_up <- GenTable(BP_up,Fisher=FisherBP_up,ranksOf="Fisher",
topNodes=length(score(FisherBP_up)))
head(BPgenTable_up)
#Format higher expressed genes
upGenes <- factor(as.integer(res$id %in% res[res$padj < 0.05 & res$log2FC >= 1,]$id))
names(upGenes) <- res$id
table(upGenes)
#GO term Enrichment for Biological Process
BP <- new("topGOdata",description="Biological Process",ontology="BP",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherBP <- runTest(BP,algorithm="parentchild",statistic="fisher")
BPgenTable <- GenTable(BP,Fisher=FisherBP,ranksOf="Fisher",
topNodes=length(score(FisherBP)))
BPgenTable$Fisher<-gsub("< ","",BPgenTable$Fisher)
BPgenTable$fdr <- p.adjust(BPgenTable$Fisher,method="fdr")
#GO term Enrichment for Molecular Function
MF <- new("topGOdata",description="Molecular Function",ontology="MF",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherMF <- runTest(MF,algorithm="parentchild",statistic="fisher")
MFgenTable <- GenTable(MF,Fisher=FisherMF,ranksOf="Fisher",
topNodes=length(score(FisherMF)))
MFgenTable$Fisher<-gsub("< ","",MFgenTable$Fisher)
MFgenTable$fdr <- p.adjust(MFgenTable$Fisher,method="fdr")
#GO term Enrichment for Cellular Component
CC <- new("topGOdata",description="Cellular Component",ontology="CC",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherCC <- runTest(CC,algorithm="parentchild",statistic="fisher")
CCgenTable <- GenTable(CC,Fisher=FisherCC,ranksOf="Fisher",
topNodes=length(score(FisherCC)))
CCgenTable$Fisher<-gsub("< ","",CCgenTable$Fisher)
CCgenTable$fdr <- p.adjust(CCgenTable$Fisher,method="fdr")
#Format higher expressed with no log2fold cutoof
upGenes <- factor(as.integer(res$id %in% res[res$padj < 0.05 & res$log2FC > 0,]$id))
names(upGenes) <- res$id
table(upGenes)
#GO term Enrichment for Biological Process
BP <- new("topGOdata",description="Biological Process",ontology="BP",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherBP <- runTest(BP,algorithm="parentchild",statistic="fisher")
BPgenTable <- GenTable(BP,Fisher=FisherBP,ranksOf="Fisher",
topNodes=length(score(FisherBP)))
BPgenTable$Fisher<-gsub("< ","",BPgenTable$Fisher)
BPgenTable$fdr <- p.adjust(BPgenTable$Fisher,method="fdr")
#GO term Enrichment for Molecular Function
MF <- new("topGOdata",description="Molecular Function",ontology="MF",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherMF <- runTest(MF,algorithm="parentchild",statistic="fisher")
MFgenTable <- GenTable(MF,Fisher=FisherMF,ranksOf="Fisher",
topNodes=length(score(FisherMF)))
MFgenTable$Fisher<-gsub("< ","",MFgenTable$Fisher)
MFgenTable$fdr <- p.adjust(MFgenTable$Fisher,method="fdr")
#GO term Enrichment for Cellular Component
CC <- new("topGOdata",description="Cellular Component",ontology="CC",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherCC <- runTest(CC,algorithm="parentchild",statistic="fisher")
CCgenTable <- GenTable(CC,Fisher=FisherCC,ranksOf="Fisher",
topNodes=length(score(FisherCC)))
CCgenTable$Fisher<-gsub("< ","",CCgenTable$Fisher)
CCgenTable$fdr <- p.adjust(CCgenTable$Fisher,method="fdr")
#Function for making dot plots of Enriched GO terms
GOdotplot <- function(x,fdr=0.05){
require(ggplot2)
x=head(x[x$fdr < fdr,],10)
ggplot(x[x$fdr < fdr,],aes(x=Significant/Annotated,
y=reorder(Term,Significant/Annotated))) +
geom_point(aes(color=fdr,size=Significant)) +
theme_bw() +
scale_color_continuous(low="red",high="blue") +
xlab("Gene Ratio (DEGs/Annotated Genes)") +
ylab("") +
labs(size="Gene Count",color="FDR") +
ggtitle("Top 10 Enriched GO Terms")
}
GOdotplot(MFgenTable)
GOdotplot(BPgenTable)
#Format higher expressed genes
upGenes <- factor(as.integer(res$id %in% res[res$padj < 0.05 & res$log2FC <= -1,]$id))
names(upGenes) <- res$id
table(upGenes)
#GO term Enrichment for Biological Process
BP <- new("topGOdata",description="Biological Process",ontology="BP",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherBP <- runTest(BP,algorithm="parentchild",statistic="fisher")
BPgenTable <- GenTable(BP,Fisher=FisherBP,ranksOf="Fisher",
topNodes=length(score(FisherBP)))
BPgenTable$Fisher<-gsub("< ","",BPgenTable$Fisher)
BPgenTable$fdr <- p.adjust(BPgenTable$Fisher,method="fdr")
#GO term Enrichment for Molecular Function
MF <- new("topGOdata",description="Molecular Function",ontology="MF",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherMF <- runTest(MF,algorithm="parentchild",statistic="fisher")
MFgenTable <- GenTable(MF,Fisher=FisherMF,ranksOf="Fisher",
topNodes=length(score(FisherMF)))
MFgenTable$Fisher<-gsub("< ","",MFgenTable$Fisher)
MFgenTable$fdr <- p.adjust(MFgenTable$Fisher,method="fdr")
#GO term Enrichment for Cellular Component
CC <- new("topGOdata",description="Cellular Component",ontology="CC",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherCC <- runTest(CC,algorithm="parentchild",statistic="fisher")
CCgenTable <- GenTable(CC,Fisher=FisherCC,ranksOf="Fisher",
topNodes=length(score(FisherCC)))
CCgenTable$Fisher<-gsub("< ","",CCgenTable$Fisher)
CCgenTable$fdr <- p.adjust(CCgenTable$Fisher,method="fdr")
#Format higher expressed with no log2fold cutoof
upGenes <- factor(as.integer(res$id %in% res[res$padj < 0.05 & res$log2FC > 0,]$id))
#Format higher expressed with no log2fold cutoof
upGenes <- factor(as.integer(res$id %in% res[res$padj < 0.05 & res$log2FC < -1,]$id))
names(upGenes) <- res$id
table(upGenes)
#GO term Enrichment for Biological Process
BP <- new("topGOdata",description="Biological Process",ontology="BP",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherBP <- runTest(BP,algorithm="parentchild",statistic="fisher")
BPgenTable <- GenTable(BP,Fisher=FisherBP,ranksOf="Fisher",
topNodes=length(score(FisherBP)))
BPgenTable$Fisher<-gsub("< ","",BPgenTable$Fisher)
BPgenTable$fdr <- p.adjust(BPgenTable$Fisher,method="fdr")
#GO term Enrichment for Molecular Function
MF <- new("topGOdata",description="Molecular Function",ontology="MF",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherMF <- runTest(MF,algorithm="parentchild",statistic="fisher")
MFgenTable <- GenTable(MF,Fisher=FisherMF,ranksOf="Fisher",
topNodes=length(score(FisherMF)))
MFgenTable$Fisher<-gsub("< ","",MFgenTable$Fisher)
MFgenTable$fdr <- p.adjust(MFgenTable$Fisher,method="fdr")
#GO term Enrichment for Cellular Component
CC <- new("topGOdata",description="Cellular Component",ontology="CC",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherCC <- runTest(CC,algorithm="parentchild",statistic="fisher")
CCgenTable <- GenTable(CC,Fisher=FisherCC,ranksOf="Fisher",
topNodes=length(score(FisherCC)))
CCgenTable$Fisher<-gsub("< ","",CCgenTable$Fisher)
CCgenTable$fdr <- p.adjust(CCgenTable$Fisher,method="fdr")
#Function for making dot plots of Enriched GO terms
GOdotplot <- function(x,fdr=0.05){
require(ggplot2)
x=head(x[x$fdr < fdr,],10)
ggplot(x[x$fdr < fdr,],aes(x=Significant/Annotated,
y=reorder(Term,Significant/Annotated))) +
geom_point(aes(color=fdr,size=Significant)) +
theme_bw() +
scale_color_continuous(low="red",high="blue") +
xlab("Gene Ratio (DEGs/Annotated Genes)") +
ylab("") +
labs(size="Gene Count",color="FDR") +
ggtitle("Top 10 Enriched GO Terms")
}
GOdotplot(BPgenTable)
table(upGenes)
#Format higher expressed with no log2fold cutoof
upGenes <- factor(as.integer(res$id %in% res[res$padj < 0.05 & res$log2FC < 0,]$id))
names(upGenes) <- res$id
table(upGenes)
#GO term Enrichment for Biological Process
BP <- new("topGOdata",description="Biological Process",ontology="BP",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherBP <- runTest(BP,algorithm="parentchild",statistic="fisher")
BPgenTable <- GenTable(BP,Fisher=FisherBP,ranksOf="Fisher",
topNodes=length(score(FisherBP)))
BPgenTable$Fisher<-gsub("< ","",BPgenTable$Fisher)
BPgenTable$fdr <- p.adjust(BPgenTable$Fisher,method="fdr")
#GO term Enrichment for Molecular Function
MF <- new("topGOdata",description="Molecular Function",ontology="MF",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherMF <- runTest(MF,algorithm="parentchild",statistic="fisher")
MFgenTable <- GenTable(MF,Fisher=FisherMF,ranksOf="Fisher",
topNodes=length(score(FisherMF)))
MFgenTable$Fisher<-gsub("< ","",MFgenTable$Fisher)
MFgenTable$fdr <- p.adjust(MFgenTable$Fisher,method="fdr")
#GO term Enrichment for Cellular Component
CC <- new("topGOdata",description="Cellular Component",ontology="CC",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherCC <- runTest(CC,algorithm="parentchild",statistic="fisher")
CCgenTable <- GenTable(CC,Fisher=FisherCC,ranksOf="Fisher",
topNodes=length(score(FisherCC)))
CCgenTable$Fisher<-gsub("< ","",CCgenTable$Fisher)
CCgenTable$fdr <- p.adjust(CCgenTable$Fisher,method="fdr")
#Function for making dot plots of Enriched GO terms
GOdotplot <- function(x,fdr=0.05){
require(ggplot2)
x=head(x[x$fdr < fdr,],10)
ggplot(x[x$fdr < fdr,],aes(x=Significant/Annotated,
y=reorder(Term,Significant/Annotated))) +
geom_point(aes(color=fdr,size=Significant)) +
theme_bw() +
scale_color_continuous(low="red",high="blue") +
xlab("Gene Ratio (DEGs/Annotated Genes)") +
ylab("") +
labs(size="Gene Count",color="FDR") +
ggtitle("Top 10 Enriched GO Terms")
}
GOdotplot(BPgenTable)
#Function for running topGO on a list of genes
#This run each of the above analyses for a gene list and output a table and plots
topGO <- function(genelist,goTerms,nodeSize,fdr=0.05,filename,path="",returnData=FALSE){
require(topGO)
require(GO.db)
ifelse(!dir.exists(path),dir.create(path), FALSE)
BP <- new("topGOdata",description="Biological Process",ontology="BP",
allGenes=genelist,annot=annFUN.gene2GO,nodeSize=nodeSize,gene2GO=goTerms)
MF <- new("topGOdata",description="Molecular Function",ontology="MF",
allGenes=genelist,annot=annFUN.gene2GO,nodeSize=nodeSize,gene2GO=goTerms)
CC <- new("topGOdata",description="Cellular Compartment",ontology="CC",
allGenes=genelist,annot=annFUN.gene2GO,nodeSize=nodeSize,gene2GO=goTerms)
FisherBP <- runTest(BP,algorithm="parentchild",statistic="fisher")
FisherMF <- runTest(MF,algorithm="parentchild",statistic="fisher")
FisherCC <- runTest(CC,algorithm="parentchild",statistic="fisher")
BPgenTable <- GenTable(BP,Fisher=FisherBP,ranksOf="Fisher",
topNodes=length(score(FisherBP)))
BPgenTable$Fisher<-gsub("< ","",BPgenTable$Fisher)
MFgenTable <- GenTable(MF,Fisher=FisherMF,ranksOf="Fisher",
topNodes=length(score(FisherMF)))
MFgenTable$Fisher<-gsub("< ","",MFgenTable$Fisher)
CCgenTable <- GenTable(CC,Fisher=FisherCC,ranksOf="Fisher",
topNodes=length(score(FisherCC)))
CCgenTable$Fisher<-gsub("< ","",CCgenTable$Fisher)
BPgenTable$fdr <- p.adjust(BPgenTable$Fisher,method="BH")
MFgenTable$fdr <- p.adjust(MFgenTable$Fisher,method="BH")
CCgenTable$fdr <- p.adjust(CCgenTable$Fisher,method="BH")
write.csv(BPgenTable[BPgenTable$fdr <= fdr,],paste(path,filename,"_BP.csv",sep=""),
row.names=FALSE,quote=FALSE)
ggsave(paste(path,filename,"_BP.pdf",sep=""),plot=GOdotplot(BPgenTable,fdr=fdr))
write.csv(MFgenTable[MFgenTable$fdr <= fdr,],paste(path,filename,"_MF.csv",sep=""),
row.names=FALSE,quote=FALSE)
ggsave(paste(path,filename,"_MF.pdf",sep=""),plot=GOdotplot(MFgenTable,fdr=fdr))
write.csv(CCgenTable[CCgenTable$fdr <= fdr,],paste(path,filename,"_CC.csv",sep=""),
row.names=FALSE,quote=FALSE)
ggsave(paste(path,filename,"_CC.pdf",sep=""),plot=GOdotplot(CCgenTable,fdr=fdr))
if(returnData){
return(list(BP=BPgenTable,MF=MFgenTable,CC=CCgenTable))
}
}
#Function for making dot plots of Enriched GO terms
GOdotplot <- function(x,fdr=0.05){
require(ggplot2)
x=head(x[x$fdr < fdr,],20)
ggplot(x[x$fdr < fdr,],aes(x=Significant/Annotated,
y=reorder(Term,Significant/Annotated))) +
geom_point(aes(color=fdr,size=Significant)) +
theme_bw() +
scale_color_continuous(low="red",high="blue") +
xlab("Gene Ratio (DEGs/Annotated Genes)") +
ylab("") +
labs(size="Gene Count",color="FDR") +
ggtitle("Top 10 Enriched GO Terms")
}
GOdotplot(MFgenTable)
#Format higher expressed with no log2fold cutoof
upGenes <- factor(as.integer(res$id %in% res[res$padj < 0.05 & res$log2FC > 0,]$id))
names(upGenes) <- res$id
table(upGenes)
#GO term Enrichment for Biological Process
BP <- new("topGOdata",description="Biological Process",ontology="BP",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherBP <- runTest(BP,algorithm="parentchild",statistic="fisher")
BPgenTable <- GenTable(BP,Fisher=FisherBP,ranksOf="Fisher",
topNodes=length(score(FisherBP)))
BPgenTable$fdr <- p.adjust(BPgenTable$Fisher,method="fdr")
#GO term Enrichment for Molecular Function
MF <- new("topGOdata",description="Molecular Function",ontology="MF",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherMF <- runTest(MF,algorithm="parentchild",statistic="fisher")
MFgenTable <- GenTable(MF,Fisher=FisherMF,ranksOf="Fisher",
topNodes=length(score(FisherMF)))
MFgenTable$Fisher<-as.numeric(MFgenTable$Fisher)
MFgenTable$fdr <- p.adjust(MFgenTable$Fisher,method="fdr")
#GO term Enrichment for Cellular Component
CC <- new("topGOdata",description="Cellular Component",ontology="CC",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherCC <- runTest(CC,algorithm="parentchild",statistic="fisher")
CCgenTable <- GenTable(CC,Fisher=FisherCC,ranksOf="Fisher",
topNodes=length(score(FisherCC)))
CCgenTable$Fisher<-as.numeric(CCgenTable$Fisher)
CCgenTable$fdr <- p.adjust(CCgenTable$Fisher,method="fdr")
#Function for making dot plots of Enriched GO terms
GOdotplot <- function(x,fdr=0.05){
require(ggplot2)
x=head(x[x$fdr < fdr,],20)
ggplot(x[x$fdr < fdr,],aes(x=Significant/Annotated,
y=reorder(Term,Significant/Annotated))) +
geom_point(aes(color=fdr,size=Significant)) +
theme_bw() +
scale_color_continuous(low="red",high="blue") +
xlab("Gene Ratio (DEGs/Annotated Genes)") +
ylab("") +
labs(size="Gene Count",color="FDR") +
ggtitle("Top 10 Enriched GO Terms")
}
GOdotplot(MFgenTable)
#GO term Enrichment for Biological Process
BP <- new("topGOdata",description="Biological Process",ontology="BP",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherBP <- runTest(BP,algorithm="parentchild",statistic="fisher")
BPgenTable <- GenTable(BP,Fisher=FisherBP,ranksOf="Fisher",
topNodes=length(score(FisherBP)))
BPgenTable$Fisher<-gsub("< ","",BPgenTable$Fisher)
BPgenTable$fdr <- p.adjust(BPgenTable$Fisher,method="fdr")
#GO term Enrichment for Molecular Function
MF <- new("topGOdata",description="Molecular Function",ontology="MF",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherMF <- runTest(MF,algorithm="parentchild",statistic="fisher")
MFgenTable <- GenTable(MF,Fisher=FisherMF,ranksOf="Fisher",
topNodes=length(score(FisherMF)))
MFgenTable$Fisher<-gsub("< ","",MFgenTable$Fisher)
MFgenTable$fdr <- p.adjust(MFgenTable$Fisher,method="fdr")
#GO term Enrichment for Cellular Component
CC <- new("topGOdata",description="Cellular Component",ontology="CC",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherCC <- runTest(CC,algorithm="parentchild",statistic="fisher")
CCgenTable <- GenTable(CC,Fisher=FisherCC,ranksOf="Fisher",
topNodes=length(score(FisherCC)))
CCgenTable$Fisher<-gsub("< ","",CCgenTable$Fisher)
CCgenTable$fdr <- p.adjust(CCgenTable$Fisher,method="fdr")
#Function for making dot plots of Enriched GO terms
GOdotplot <- function(x,fdr=0.05){
require(ggplot2)
x=head(x[x$fdr < fdr,],20)
ggplot(x[x$fdr < fdr,],aes(x=Significant/Annotated,
y=reorder(Term,Significant/Annotated))) +
geom_point(aes(color=fdr,size=Significant)) +
theme_bw() +
scale_color_continuous(low="red",high="blue") +
xlab("Gene Ratio (DEGs/Annotated Genes)") +
ylab("") +
labs(size="Gene Count",color="FDR") +
ggtitle("Top 10 Enriched GO Terms")
}
GOdotplot(MFgenTable)
#Function for making dot plots of Enriched GO terms
GOdotplot <- function(x,fdr=0.05){
require(ggplot2)
x=head(x[x$fdr < fdr,],20)
ggplot(x[x$fdr < fdr,],aes(x=Significant/Annotated,
y=reorder(Term,Significant/Annotated))) +
geom_point(aes(color=fdr,size=Significant)) +
theme_bw() +
scale_color_continuous(low="red",high="blue") +
xlab("Gene Ratio (DEGs/Annotated Genes)") +
ylab("") +
labs(size="Gene Count",color="FDR") +
ggtitle("Top 10 Enriched GO Terms")
}
GOdotplot(MFgenTable)
#Function for making dot plots of Enriched GO terms
GOdotplot <- function(x,fdr=0.05){
require(ggplot2)
x=head(x[x$fdr < fdr,],10)
ggplot(x[x$fdr < fdr,],aes(x=Significant/Annotated,
y=reorder(Term,Significant/Annotated))) +
geom_point(aes(color=fdr,size=Significant)) +
theme_bw() +
scale_color_continuous(low="red",high="blue") +
xlab("Gene Ratio (DEGs/Annotated Genes)") +
ylab("") +
labs(size="Gene Count",color="FDR") +
ggtitle("Top 10 Enriched GO Terms")
}
GOdotplot(MFgenTable)
showSigOfNodes(BP, score(FisherBP), firstSigNodes = 5, useInfo = 'all')
BiocManager::install("Rgraphviz")
showSigOfNodes(BP, score(FisherBP), firstSigNodes = 5, useInfo = 'all')
showSigOfNodes(BP, score(FisherBP), firstSigNodes = 20, useInfo = 'all')
showSigOfNodes(BP, score(FisherBP), firstSigNodes = 20, useInfo = 'all')
showSigOfNodes(MF, score(FisherMF), firstSigNodes = 20, useInfo = 'all')
showSigOfNodes(MF, score(FisherMF), firstSigNodes = 20, useInfo = 'all')
#GO term Enrichment for Biological Process
BP <- new("topGOdata",description="Biological Process",ontology="BP",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherBP <- runTest(BP,algorithm="parentchild",statistic="fisher")
BPgenTable <- GenTable(BP,Fisher=FisherBP,ranksOf="Fisher",
topNodes=length(score(FisherBP)))
BPgenTable
head(BPgenTable)
MFgenTable$fdr <- p.adjust(MFgenTable$Fisher,method="fdr")
MFgenTable[MFgenTable$fdr <= 0.05,]
#Install topGO
if (!require("topGO", quietly = TRUE))
BiocManager::install("topGO")
#Install GO.db
if (!require("GO.db", quietly = TRUE))
BiocManager::install("GO.db")
#Load the libraries
library(topGO)
library(GO.db)
#Read in our genes
res <- read.table("deseq2_results.tsv",header=TRUE,sep="\t")
head(res)
table(res$sig)
#Read in topGO terms
goTerms <- readMappings(file="Athaliana_topGO.tsv")
head(goTerms)
#Format higher expressed genes
upGenes <- factor(as.integer(res$id %in% res[res$padj < 0.05 & res$log2FC >= 1,]$id))
names(upGenes) <- res$id
table(upGenes)
#GO term Enrichment for Biological Process
BP <- new("topGOdata",description="Biological Process",ontology="BP",
allGenes=upGenes,annot=annFUN.gene2GO,nodeSize=3,gene2GO=goTerms)
FisherBP <- runTest(BP,algorithm="parentchild",statistic="fisher")
BPgenTable <- GenTable(BP,Fisher=FisherBP,ranksOf="Fisher",
topNodes=length(score(FisherBP)))
head(BPgenTable)
BPgenTable$Fisher<-gsub("< ","",BPgenTable$Fisher)
BPgenTable$fdr <- p.adjust(BPgenTable$Fisher,method="fdr")
head(BPgenTable)
#Function for making dot plots of Enriched GO terms
GOdotplot <- function(x,fdr=0.05){
require(ggplot2)
x=head(x[x$fdr <= fdr,],10)
ggplot(x[x$fdr <= fdr,],aes(x=Significant/Annotated,
y=reorder(Term,Significant/Annotated))) +
geom_point(aes(color=fdr,size=Significant)) +
theme_bw() +
scale_color_continuous(low="red",high="blue") +
xlab("Gene Ratio (DEGs/Annotated Genes)") +
ylab("") +
labs(size="Gene Count",color="FDR") +
ggtitle("Top 10 Enriched GO Terms")
}
GOdotplot(MFgenTable)
#Install Rgraphviz
if (!require("Rgraphviz", quietly = TRUE))
BiocManager::install("Rgraphviz")
showSigOfNodes(MF, score(FisherMF), firstSigNodes = 20, useInfo = 'all')
#Function for running topGO on a list of genes
#This run each of the above analyses for a gene list and output a table and plots
topGO <- function(genelist,goTerms,nodeSize,fdr=0.05,filename,path="",returnData=FALSE){
require(topGO)
require(GO.db)
ifelse(!dir.exists(path),dir.create(path), FALSE)
BP <- new("topGOdata",description="Biological Process",ontology="BP",
allGenes=genelist,annot=annFUN.gene2GO,nodeSize=nodeSize,gene2GO=goTerms)
MF <- new("topGOdata",description="Molecular Function",ontology="MF",
allGenes=genelist,annot=annFUN.gene2GO,nodeSize=nodeSize,gene2GO=goTerms)
CC <- new("topGOdata",description="Cellular Compartment",ontology="CC",
allGenes=genelist,annot=annFUN.gene2GO,nodeSize=nodeSize,gene2GO=goTerms)
FisherBP <- runTest(BP,algorithm="parentchild",statistic="fisher")
FisherMF <- runTest(MF,algorithm="parentchild",statistic="fisher")
FisherCC <- runTest(CC,algorithm="parentchild",statistic="fisher")
BPgenTable <- GenTable(BP,Fisher=FisherBP,ranksOf="Fisher",
topNodes=length(score(FisherBP)))
BPgenTable$Fisher<-gsub("< ","",BPgenTable$Fisher)
MFgenTable <- GenTable(MF,Fisher=FisherMF,ranksOf="Fisher",
topNodes=length(score(FisherMF)))
MFgenTable$Fisher<-gsub("< ","",MFgenTable$Fisher)
CCgenTable <- GenTable(CC,Fisher=FisherCC,ranksOf="Fisher",
topNodes=length(score(FisherCC)))
CCgenTable$Fisher<-gsub("< ","",CCgenTable$Fisher)
BPgenTable$fdr <- p.adjust(BPgenTable$Fisher,method="BH")
MFgenTable$fdr <- p.adjust(MFgenTable$Fisher,method="BH")
CCgenTable$fdr <- p.adjust(CCgenTable$Fisher,method="BH")
write.csv(BPgenTable[BPgenTable$fdr <= fdr,],paste(path,filename,"_BP.csv",sep=""),
row.names=FALSE,quote=FALSE)
ggsave(paste(path,filename,"_BP.pdf",sep=""),plot=GOdotplot(BPgenTable,fdr=fdr))
write.csv(MFgenTable[MFgenTable$fdr <= fdr,],paste(path,filename,"_MF.csv",sep=""),
row.names=FALSE,quote=FALSE)
ggsave(paste(path,filename,"_MF.pdf",sep=""),plot=GOdotplot(MFgenTable,fdr=fdr))
write.csv(CCgenTable[CCgenTable$fdr <= fdr,],paste(path,filename,"_CC.csv",sep=""),
row.names=FALSE,quote=FALSE)
ggsave(paste(path,filename,"_CC.pdf",sep=""),plot=GOdotplot(CCgenTable,fdr=fdr))
if(returnData){
return(list(BP=BPgenTable,MF=MFgenTable,CC=CCgenTable))
}
}
GOdotplot(MFgenTable)
